

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>&lt;no title&gt; &mdash; fluxfootprint 0.1.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=92734c54"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            fluxfootprint
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../fluxfootprints.html">fluxfootprints package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">fluxfootprints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exp.html">Flux Footprints: Key Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modeltypes.html">Outline of Flux Measurement Footprint Estimation Approaches</a></li>
<li class="toctree-l1"><a class="reference internal" href="footprint.html">Quick-start notebook</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">fluxfootprint</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">&lt;no title&gt;</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks/AMF_Daily.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <dl>
<dt>{</dt><dd><dl>
<dt>“cells”: [</dt><dd><dl>
<dt>{</dt><dd><p>“cell_type”: “markdown”,
“id”: “ca83666e”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“# Import Libraries”</p>
</div></blockquote>
<p>]</p>
</dd>
</dl>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: 3,
“id”: “7c37b032ace71dd8”,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“import pathlibn”,
“import sysn”,
“import numpy as npn”,
“import pandas as pdn”,
“import rasterion”,
“import refetn”,
“import pyprojn”,
“import xarrayn”,
“import requestsn”,
“import multiprocessing as mpn”,
“import configparsern”,
“import matplotlib.pyplot as pltn”,
“import geopandas as gpdn”,
“%matplotlib inline”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: null,
“id”: “7120c2a4705ae687”,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“#sys.path.append(&quot;//&quot;)n”,
“sys.path.append(&quot;../../src&quot;)n”,
“import fluxfootprintsn”,
“#from micromet.volk import ffp_climatology as ffpn”,
“import fluxfootprints.volk as volk”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: null,
“id”: “3588a65ad79b640e”,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“import logging”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: 9,
“id”: “2142d1d3d4a7e576”,
“metadata”: {},
“outputs”: [</p>
<blockquote>
<div><dl>
<dt>{</dt><dd><p>“name”: “stdout”,
“output_type”: “stream”,
“text”: [</p>
<blockquote>
<div><p>“US-UTEn”,
“Falsen”,
“Failed to fetch data for station US-UTE: 401 Client Error: Unauthorized for url: <a class="reference external" href="https://ugs-koop-umfdxaxiyq-wm.a.run.app/amfluxeddy?stationid=eq.US-UTE&amp;datetime_start=gte.2021-01-01n">https://ugs-koop-umfdxaxiyq-wm.a.run.app/amfluxeddy?stationid=eq.US-UTE&amp;datetime_start=gte.2021-01-01n</a>”,
“No valid data found for station US-UTE. Skipping.n”,
“US-UTWn”,
“Falsen”,
“Failed to fetch data for station US-UTW: 401 Client Error: Unauthorized for url: <a class="reference external" href="https://ugs-koop-umfdxaxiyq-wm.a.run.app/amfluxeddy?stationid=eq.US-UTW&amp;datetime_start=gte.2021-01-01n">https://ugs-koop-umfdxaxiyq-wm.a.run.app/amfluxeddy?stationid=eq.US-UTW&amp;datetime_start=gte.2021-01-01n</a>”,
“No valid data found for station US-UTW. Skipping.n”</p>
</div></blockquote>
<p>]</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>],
“source”: [</p>
<blockquote>
<div><p>“config_path = pathlib.Path(f’../../data/station_config’)n”,
“n”,
“# iterate through all of the station configuration filesn”,
“for stationfile in config_path.glob(&quot;US*.ini&quot;):n”,
“n”,
“    station = stationfile.stemn”,
“    print(station)n”,
“    outfolder = station.replace(‘-‘,’’).lower()n”,
“n”,
“    # Specify the directory pathn”,
“    out_dir = pathlib.Path(f&quot;./output/{outfolder}&quot;)n”,
“    print(out_dir.exists())n”,
“    # Check if the directory exists; if not, create it (including parent directories)n”,
“    if not out_dir.exists():n”,
“        out_dir.mkdir(parents=True)n”,
“    else:n”,
“        passn”,
“n”,
“    # calculate the hourly footprint using Kljunn”,
“    fluxfootprints.calc_hourly_ffp(station,n”,
“                         startdate=’2021-01-01’,n”,
“                         config_path=config_path,n”,
“                         out_dir=out_dir,n”,
“                         secrets_path=’../../secrets/config.ini’,n”,
“                         epsg=5070,n”,
“                         h_c=0.2,n”,
“                         zm_s=2.0,n”,
“                         dx=5.0,n”,
“                         h_s=2000.0,n”,
“                         origin_d=500.0,n”,
“                             )n”,
“n”,
“    # generate weighted daily rastersn”,
“    fluxfootprints.weighted_rasters(stationid=station,n”,
“                              start_hr=6,n”,
“                              normed_NLDAS_stats_path=’output/nldas_all_normed.parquet’,n”,
“                              out_dir=out_dir,n”,
“                              )n”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: null,
“id”: “29623ad74a9ed1c0”,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“config_path = pathlib.Path(f’../../station_config’)n”,
“# iterate through all of the station configuration filesn”,
“statpolys = {}n”,
“n”,
“for stationfile in config_path.glob(&quot;US*.ini&quot;):n”,
“n”,
“    station = stationfile.stemn”,
“    print(station)n”,
“    outfolder = station.replace(‘-‘,’’).lower()n”,
“n”,
“    # Specify the directory pathn”,
“    out_dir = pathlib.Path(f&quot;./output/{outfolder}&quot;)n”,
“    gdfs = {}n”,
“    for rasterfile in out_dir.glob(&quot;<a href="#id1"><span class="problematic" id="id2">*</span></a>weighted.tif&quot;):n”,
“       rdate = rasterfile.stem.split(&quot;_&quot;)[0]n”,
“       gdfs[rdate] = fluxfootprints.outline_valid_cells(rasterfile, out_file=None)n”,
“n”,
“    statpolys[station] = pd.concat(gdfs)n”,
“    statpolys[station].to_file(f&quot;{station}_weighted_raster.geojson&quot;)n”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: null,
“id”: “58687f7fc58a926d”,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“n”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: null,
“id”: “a57c45894a6254e8”,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“station = &quot;US-UTE&quot;n”,
“model = ‘ensemble’n”,
“pathnm = station.lower().replace(‘-‘,’’)n”,
“n”,
“dir1 = pathlib.Path(f&quot;./output/{pathnm}/&quot;)    # e.g., contains ‘…20210305.tif’, etc.n”,
“n”,
“dir2 = pathlib.Path(&quot;G:/My Drive/OpenET Exports/&quot;)n”,
“n”,
“out_dir = pathlib.Path(f&quot;./output/{pathnm}_mult/&quot;)n”,
“n”,
“tsum = micromet.multiply_directories_rast(dir1, dir2, out_dir=out_dir,model=model)n”,
“n”,
“series= pd.Series(tsum)n”,
“n”,
“metadata = fluxfootprints.load_configs(station,n”,
“                 config_path=’.’,n”,
“                 secrets_path=&quot;../../secrets/config.ini&quot;)n”,
“df = fluxfootprints.fetch_and_preprocess_data(metadata[&quot;url&quot;], station, startdate=’2023-01-01’)n”,
“s = df[‘et’]n”,
“n”,
“# replace values less than 0 with 0n”,
“s = s.where(s &gt;= 0, 0)n”,
“# resample with daily, only keeping days with more than 19 records.n”,
“daily_stat_et = s.dropna().resample(‘D’).sum(min_count=20)”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: null,
“id”: “97103e7676c818ca”,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“et_compare = pd.concat([daily_stat_et,series],axis=1)n”,
“et_compare.columns = [‘station_mm’,’ens_mm’]n”,
“plt.scatter(et_compare[‘station_mm’],et_compare[‘ens_mm’])n”,
“plt.xlabel(‘Raw Daily Station ET (mm)’)n”,
“plt.ylabel(f’{model} ET (mm)’)n”,
“plt.title(f&quot;{station} from {et_compare.first_valid_index():%Y-%m-%d} to {et_compare.last_valid_index():%Y-%m-%d}&quot;)n”,
“plt.savefig(f&quot;{station}_ET.pdf&quot;)n”,
“plt.savefig(f&quot;{station}_ET.png&quot;)”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
<p>],
“metadata”: {</p>
<blockquote>
<div><dl class="simple">
<dt>“kernelspec”: {</dt><dd><p>“display_name”: “py313”,
“language”: “python”,
“name”: “python3”</p>
</dd>
</dl>
<p>},
“language_info”: {</p>
<blockquote>
<div><dl class="simple">
<dt>“codemirror_mode”: {</dt><dd><p>“name”: “ipython”,
“version”: 3</p>
</dd>
</dl>
<p>},
“file_extension”: “.py”,
“mimetype”: “text/x-python”,
“name”: “python”,
“nbconvert_exporter”: “python”,
“pygments_lexer”: “ipython3”,
“version”: “3.13.1”</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
“nbformat”: 5,
“nbformat_minor”: 9</p>
</dd>
</dl>
<p>}</p>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Paul Inkenbrandt, Natascha Kljun, John Volk.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>